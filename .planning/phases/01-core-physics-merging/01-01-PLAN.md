---
phase: 01-core-physics-merging
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - project.godot
  - scripts/autoloads/event_bus.gd
  - scripts/autoloads/game_manager.gd
  - resources/fruit_data/fruit_data.gd
  - resources/fruit_data/tier_1_blueberry.tres
  - resources/fruit_data/tier_2_grape.tres
  - resources/fruit_data/tier_3_cherry.tres
  - resources/fruit_data/tier_4_strawberry.tres
  - resources/fruit_data/tier_5_orange.tres
  - resources/fruit_data/tier_6_apple.tres
  - resources/fruit_data/tier_7_pear.tres
  - resources/fruit_data/tier_8_watermelon.tres
  - resources/fruit_physics.tres
  - scenes/bucket/bucket.tscn
  - scenes/bucket/bucket.gd
  - scenes/background/background.tscn
  - assets/sprites/fruits/placeholder_fruit.png
  - assets/sprites/bucket/placeholder_bucket.png
autonomous: true

must_haves:
  truths:
    - "8 fruit tiers exist as data resources with increasing sizes (15px to 80px radius)"
    - "A trapezoid bucket container is visible and has physics collision walls"
    - "Physics settings are tuned for stable stacking (solver iterations 6, damping, friction)"
    - "EventBus autoload provides signals for cross-system communication"
  artifacts:
    - path: "resources/fruit_data/fruit_data.gd"
      provides: "FruitData custom Resource class"
      contains: "class_name FruitData"
    - path: "resources/fruit_data/tier_1_blueberry.tres"
      provides: "Tier 1 fruit configuration"
      contains: "tier = 0"
    - path: "resources/fruit_data/tier_8_watermelon.tres"
      provides: "Tier 8 fruit configuration"
      contains: "tier = 7"
    - path: "scripts/autoloads/event_bus.gd"
      provides: "Global signal bus"
      contains: "signal fruit_merged"
    - path: "scripts/autoloads/game_manager.gd"
      provides: "Game state management"
      contains: "enum GameState"
    - path: "scenes/bucket/bucket.tscn"
      provides: "Trapezoid container scene"
    - path: "project.godot"
      provides: "Physics config and autoloads"
      contains: "solver_iterations"
  key_links:
    - from: "project.godot"
      to: "scripts/autoloads/event_bus.gd"
      via: "autoload registration"
      pattern: "event_bus"
    - from: "project.godot"
      to: "scripts/autoloads/game_manager.gd"
      via: "autoload registration"
      pattern: "game_manager"
---

<objective>
Set up the Godot project foundation: physics configuration, autoloads, the FruitData resource system with all 8 tiers, the trapezoid bucket container scene, and a themed background. This is the foundation everything else builds on.

Purpose: Every subsequent plan needs physics settings, fruit data, the bucket container, and the EventBus signal system. Building these first unblocks all other Phase 1 work.
Output: A runnable Godot project with a visible bucket on a kitchen background, 8 fruit data resources, and all autoloads registered.
</objective>

<execution_context>
@C:/Users/zycro/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/zycro/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-core-physics-merging/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create project config, autoloads, and FruitData resource system</name>
  <files>
    project.godot
    scripts/autoloads/event_bus.gd
    scripts/autoloads/game_manager.gd
    resources/fruit_data/fruit_data.gd
    resources/fruit_data/tier_1_blueberry.tres
    resources/fruit_data/tier_2_grape.tres
    resources/fruit_data/tier_3_cherry.tres
    resources/fruit_data/tier_4_strawberry.tres
    resources/fruit_data/tier_5_orange.tres
    resources/fruit_data/tier_6_apple.tres
    resources/fruit_data/tier_7_pear.tres
    resources/fruit_data/tier_8_watermelon.tres
    resources/fruit_physics.tres
  </files>
  <action>
    **project.godot:**
    Create a Godot 4.5 project file with:
    - Display: window size 1080x1920 (portrait mobile-first), stretch mode "canvas_items", aspect "keep_width"
    - Physics 2D settings: default_gravity=980, solver_iterations=6, default_linear_damp=0.5, default_angular_damp=1.0
    - Physics ticks: 60 per second
    - Collision layers named: Layer 1="Fruits", Layer 2="Container", Layer 3="Overflow"
    - Autoloads: EventBus (scripts/autoloads/event_bus.gd), GameManager (scripts/autoloads/game_manager.gd)
    - Renderer: compatibility (OpenGL)
    - Input map: "drop" action mapped to left mouse button and touch screen tap

    **event_bus.gd:**
    Create a Node-based autoload with typed signals only (no logic):
    ```gdscript
    signal fruit_merged(old_tier: int, new_tier: int, position: Vector2)
    signal fruit_dropped(tier: int, position: Vector2)
    signal game_over_triggered()
    signal game_state_changed(new_state: int)
    ```

    **game_manager.gd:**
    Create a Node-based autoload with:
    - `enum GameState { READY, DROPPING, WAITING, GAME_OVER }`
    - `var current_state: GameState = GameState.READY`
    - `var score: int = 0` (score logic is Phase 2, but the variable lives here)
    - `func change_state(new_state: GameState)` that updates current_state and emits EventBus.game_state_changed
    - `func reset_game()` that resets score and state to READY

    **fruit_data.gd:**
    Create FruitData custom Resource class (class_name FruitData, extends Resource) with exported properties:
    - `tier: int` (0-indexed, 0-7)
    - `fruit_name: String`
    - `radius: float` (collision radius in pixels)
    - `sprite: Texture2D` (fruit texture)
    - `score_value: int`
    - `color: Color` (tint for effects, future phases)
    - `mass_override: float`
    - `is_droppable: bool`

    **8 .tres resource files:**
    Create each as a Resource with type fruit_data.gd, using these values:

    | Tier | Name | Radius | Mass | Score | Droppable | Color |
    |------|------|--------|------|-------|-----------|-------|
    | 0 | Blueberry | 15 | 0.5 | 1 | true | #4169E1 (royal blue) |
    | 1 | Grape | 20 | 0.8 | 3 | true | #8B008B (purple) |
    | 2 | Cherry | 27 | 1.2 | 6 | true | #DC143C (crimson) |
    | 3 | Strawberry | 35 | 1.8 | 10 | true | #FF4500 (red-orange) |
    | 4 | Orange | 44 | 2.5 | 15 | true | #FF8C00 (dark orange) |
    | 5 | Apple | 54 | 3.5 | 21 | false | #228B22 (green) |
    | 6 | Pear | 66 | 5.0 | 28 | false | #9ACD32 (yellow-green) |
    | 7 | Watermelon | 80 | 7.0 | 36 | false | #2E8B57 (sea green) |

    For sprite: point all .tres files at a shared placeholder texture (assets/sprites/fruits/placeholder_fruit.png). Create a simple 64x64 white circle PNG as placeholder. Proper art comes later.

    **fruit_physics.tres:**
    Create a PhysicsMaterial resource: friction=0.6, bounce=0.15. This will be shared by all fruits.

    IMPORTANT: Godot .tres files are text-based resource files. Write them as Godot resource format with [gd_resource] header and proper type references. The FruitData .tres files need to reference the fruit_data.gd script as their script type.
  </action>
  <verify>
    Open the project in Godot 4.5 editor. Verify:
    1. Project opens without errors
    2. EventBus and GameManager appear in Project > Autoloads
    3. Each .tres file opens in the inspector and shows correct property values
    4. Physics 2D settings in Project Settings show solver_iterations=6, gravity=980
  </verify>
  <done>
    project.godot exists with correct physics settings and autoloads. 8 FruitData .tres files exist with correct tier values. EventBus has 4 signals. GameManager has GameState enum and reset_game().
  </done>
</task>

<task type="auto">
  <name>Task 2: Create trapezoid bucket scene and themed kitchen background</name>
  <files>
    scenes/bucket/bucket.tscn
    scenes/bucket/bucket.gd
    scenes/background/background.tscn
  </files>
  <action>
    **bucket.tscn:**
    Create a StaticBody2D scene with the following structure:
    ```
    Bucket (StaticBody2D) -- collision layer 2 (Container), no mask needed
      +-- BucketArt (Polygon2D) -- visual trapezoid shape, light wood color (#D2B48C tan with #8B7355 darker outline)
      +-- LeftWall (CollisionPolygon2D) -- angled left wall with ~10px thickness
      +-- RightWall (CollisionPolygon2D) -- angled right wall (mirror of left)
      +-- Floor (CollisionPolygon2D) -- flat bottom with ~10px thickness
      +-- RimHighlight (Line2D) -- top rim of the bucket, darker color (#6B4226), used for overflow glow effect
      +-- OverflowLine (Node2D with _draw override) -- dashed line inside bucket using draw_dashed_line()
    ```

    Bucket dimensions (designed for 1080x1920 viewport, bucket centered horizontally at x=540):
    - Top opening: ~400px wide (x: 340 to 740)
    - Bottom floor: ~260px wide (x: 410 to 670)
    - Height: ~550px
    - Bucket top Y: ~700 (leaving room for drop zone above)
    - Bucket bottom Y: ~1250
    - Overflow line Y: ~760 (about 60px below the bucket rim)
    - Wall thickness: 12px for collision polygons

    The BucketArt Polygon2D draws the visible bucket shape using a filled polygon with wood-like color. Use a slightly darker outline stroke. The bucket should look like a wooden container -- planks suggested by 2-3 subtle horizontal lines drawn via _draw() in bucket.gd.

    **bucket.gd:**
    Script attached to Bucket StaticBody2D:
    - Store bucket geometry constants (top_left, top_right, bottom_left, bottom_right, overflow_y) as exported variables so other systems can query bucket bounds
    - `func get_drop_bounds() -> Vector2` returns Vector2(left_x, right_x) for clamping drop position
    - `func get_overflow_y() -> float` returns the Y position of the overflow line
    - Implement rim glow: `func set_warning_level(level: float)` where 0.0=normal, 1.0=full warning. Modulates RimHighlight color from default to red based on level. (Called by OverflowDetector in Plan 03.)
    - Draw subtle wood plank lines in _draw() -- 2-3 faint horizontal lines across the bucket body

    The OverflowLine child node draws a dashed line using Godot 4's native `draw_dashed_line()`:
    - Semi-transparent red: Color(1.0, 0.3, 0.3, 0.4)
    - Line width: 2.0, dash length: 10.0
    - Spans the interior width of the bucket at overflow_y

    **background.tscn:**
    Create a simple kitchen counter background scene:
    - ColorRect or Polygon2D filling the viewport (1080x1920)
    - Upper portion: warm wall color (#F5E6D0 or similar warm cream)
    - Lower portion (below ~600y): counter surface color (#A0826D warm brown)
    - Optional: a subtle line separating wall from counter
    - This is a flat/vector aesthetic background -- no complex textures needed, just warm solid colors with maybe 1-2 accent lines

    IMPORTANT: All collision polygons use Godot's CollisionPolygon2D with PackedVector2Array points. Points are defined clockwise. Each wall is a thin polygon (not a line) to prevent tunneling. Set the bucket's collision layer to layer 2 (Container).
  </action>
  <verify>
    1. Open bucket.tscn in Godot editor -- trapezoid shape visible with wood-colored fill
    2. Collision shapes visible in editor debug view (enable "Show collision shapes")
    3. Background scene fills viewport with warm kitchen colors
    4. Run a minimal test scene with just the bucket and background visible -- bucket renders correctly centered in viewport
  </verify>
  <done>
    Trapezoid bucket scene exists with 3 collision polygons (left wall, right wall, floor), visible wood-textured art, dashed overflow line, rim highlight for glow effect, and bucket geometry query functions. Kitchen background scene exists with warm color palette.
  </done>
</task>

</tasks>

<verification>
1. Godot project opens without errors or warnings
2. Autoloads (EventBus, GameManager) are registered and accessible from any script via their names
3. All 8 FruitData .tres files load in the inspector with correct values
4. Bucket scene shows trapezoid shape with collision areas when run
5. Physics settings in project.godot match specifications (gravity=980, solver_iterations=6)
</verification>

<success_criteria>
- project.godot exists with correct physics, display, autoload, and input settings
- EventBus autoload has fruit_merged, fruit_dropped, game_over_triggered, game_state_changed signals
- GameManager autoload has GameState enum, current_state, score, change_state(), reset_game()
- 8 FruitData .tres resources exist with correct tier/radius/mass/score/droppable values
- PhysicsMaterial .tres exists with friction=0.6, bounce=0.15
- Bucket scene renders a visible trapezoid with collision walls on layer 2
- Background scene shows warm kitchen counter colors
- Bucket exposes geometry query functions (get_drop_bounds, get_overflow_y, set_warning_level)
</success_criteria>

<output>
After completion, create `.planning/phases/01-core-physics-merging/01-01-SUMMARY.md`
</output>
