---
phase: 09-fruit-sprites
plan: 02
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - resources/fruit_data/tier_1_cherry.tres
  - resources/fruit_data/tier_2_grape.tres
  - resources/fruit_data/tier_3_strawberry.tres
  - resources/fruit_data/tier_4_orange.tres
  - resources/fruit_data/tier_5_apple.tres
  - resources/fruit_data/tier_6_peach.tres
  - resources/fruit_data/tier_7_pineapple.tres
  - resources/fruit_data/tier_8_watermelon.tres
  - scenes/fruit/fruit.gd
  - scenes/fruit/fruit.tscn
  - scenes/fruit/face_renderer.gd
  - scripts/components/merge_manager.gd
  - scripts/components/score_manager.gd
  - scripts/components/merge_feedback.gd
  - scripts/components/card_effect_system.gd
  - scenes/ui/hud.gd
autonomous: true

must_haves:
  truths:
    - "Each of the 8 fruit tiers displays its unique kawaii sprite in-game"
    - "Fruit sprites render correctly at all sizes from 15px to 80px radius"
    - "Fruits collide, stack, and merge identically to v1.0 -- no physics changes"
    - "FaceRenderer draw-based faces are fully removed"
    - "White circle color tinting is fully removed -- sprites show natural fruit colors"
    - "Fruit names match new lineup: cherry, grape, strawberry, orange, apple, peach, pineapple, watermelon"
  artifacts:
    - path: "resources/fruit_data/tier_1_cherry.tres"
      provides: "Tier 0 FruitData with cherry sprite and name"
      contains: "fruit_name = \"Cherry\""
    - path: "resources/fruit_data/tier_6_peach.tres"
      provides: "Tier 5 FruitData with peach sprite and name"
      contains: "fruit_name = \"Peach\""
    - path: "resources/fruit_data/tier_7_pineapple.tres"
      provides: "Tier 6 FruitData with pineapple sprite and name"
      contains: "fruit_name = \"Pineapple\""
    - path: "scenes/fruit/fruit.gd"
      provides: "Fruit initialization without FaceRenderer or color modulate"
    - path: "scenes/fruit/fruit.tscn"
      provides: "Fruit scene without FaceRenderer node"
  key_links:
    - from: "resources/fruit_data/tier_1_cherry.tres"
      to: "assets/sprites/fruits/cherry.png"
      via: "Texture2D ext_resource"
      pattern: "cherry\\.png"
    - from: "scenes/fruit/fruit.gd"
      to: "fruit_data.sprite"
      via: "Sprite2D.texture assignment in initialize()"
      pattern: "\\$Sprite2D\\.texture = data\\.sprite"
    - from: "scripts/components/merge_manager.gd"
      to: "resources/fruit_data/tier_1_cherry.tres"
      via: "FruitData path array"
      pattern: "tier_1_cherry"
---

<objective>
Integrate the 8 kawaii fruit sprites into the game, rename all fruit tiers to match the new lineup (cherry, grape, strawberry, orange, apple, peach, pineapple, watermelon), and remove the old procedural visual system (FaceRenderer + color tinting).

Purpose: Complete the visual transition from placeholder white circles with vector faces to kawaii sprite art. The art change is purely visual with zero physics side effects.

Output: All 8 FruitData .tres files updated with new sprites, names, and colors. fruit.gd/fruit.tscn cleaned of old visual systems. All path references updated. face_renderer.gd deleted.
</objective>

<execution_context>
@/home/zycroft/.claude/get-shit-done/workflows/execute-plan.md
@/home/zycroft/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-fruit-sprites/09-CONTEXT.md
@.planning/phases/09-fruit-sprites/09-01-SUMMARY.md
@scenes/fruit/fruit.gd
@scenes/fruit/fruit.tscn
@scenes/fruit/face_renderer.gd
@resources/fruit_data/fruit_data.gd
@resources/fruit_data/tier_1_blueberry.tres
@resources/fruit_data/tier_7_pear.tres
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rename tier files, update names/colors/sprites, and fix all path references</name>
  <files>
    resources/fruit_data/tier_1_cherry.tres
    resources/fruit_data/tier_2_grape.tres
    resources/fruit_data/tier_3_strawberry.tres
    resources/fruit_data/tier_4_orange.tres
    resources/fruit_data/tier_5_apple.tres
    resources/fruit_data/tier_6_peach.tres
    resources/fruit_data/tier_7_pineapple.tres
    resources/fruit_data/tier_8_watermelon.tres
    scripts/components/merge_manager.gd
    scripts/components/score_manager.gd
    scripts/components/merge_feedback.gd
    scripts/components/card_effect_system.gd
    scenes/ui/hud.gd
  </files>
  <action>
    The new fruit lineup replaces old names at each tier position. Physics properties (radius, mass, score_value, is_droppable) stay EXACTLY as they are per tier -- only fruit_name, color, sprite, and filename change.

    **Complete tier mapping (old -> new):**

    | File (1-indexed) | Tier (0-indexed) | Old Name | New Name | Old Color | New Color (for particles/effects) | Sprite File |
    |---|---|---|---|---|---|---|
    | tier_1 | 0 | Blueberry | Cherry | (0.255,0.412,0.882) | (0.863,0.078,0.235,1) deep red | cherry.png |
    | tier_2 | 1 | Grape | Grape | (0.545,0.0,0.545) | unchanged | grape.png |
    | tier_3 | 2 | Cherry | Strawberry | (0.863,0.078,0.235) | (1.0,0.271,0.0,1) red-orange | strawberry.png |
    | tier_4 | 3 | Strawberry | Orange | (1.0,0.271,0.0) | (1.0,0.549,0.0,1) orange | orange.png |
    | tier_5 | 4 | Orange | Apple | (1.0,0.549,0.0) | (0.133,0.545,0.133,1) green | apple.png |
    | tier_6 | 5 | Apple | Peach | (0.133,0.545,0.133) | (1.0,0.702,0.612,1) peach pink | peach.png |
    | tier_7 | 6 | Pear | Pineapple | (0.604,0.804,0.196) | (0.855,0.647,0.125,1) golden | pineapple.png |
    | tier_8 | 7 | Watermelon | Watermelon | (0.180,0.545,0.341) | unchanged | watermelon.png |

    **Step 1: Rename .tres files** using `git mv` for the 6 that change names:
    ```
    git mv tier_1_blueberry.tres tier_1_cherry.tres
    git mv tier_3_cherry.tres tier_3_strawberry.tres
    git mv tier_4_strawberry.tres tier_4_orange.tres
    git mv tier_5_orange.tres tier_5_apple.tres
    git mv tier_6_apple.tres tier_6_peach.tres
    git mv tier_7_pear.tres tier_7_pineapple.tres
    ```
    (tier_2_grape.tres and tier_8_watermelon.tres keep their names.)

    NOTE: Since tier_3_cherry -> tier_3_strawberry and tier_4_strawberry -> tier_4_orange could conflict (tier_4_strawberry exists before renaming), do the renames in an order that avoids collision. Safe order: rename tier_1 first, then tier_7, tier_6, tier_5, tier_4, then tier_3.

    **Step 2: Update each .tres file contents:**
    For each of the 8 files, update three fields:
    - `fruit_name = "NewName"` (per mapping table)
    - `color = Color(...)` (per mapping table, only 6 change)
    - Change the sprite ext_resource path from `placeholder_fruit.png` to the fruit's own PNG: `res://assets/sprites/fruits/{name}.png`

    DO NOT change: tier, radius, score_value, mass_override, is_droppable. These are physics-tied and must remain as-is.

    **Step 3: Update all FruitData path arrays in 5 GDScript files:**
    The following files all have identical path arrays listing all 8 .tres files:
    - `scripts/components/merge_manager.gd`
    - `scripts/components/score_manager.gd`
    - `scripts/components/merge_feedback.gd`
    - `scripts/components/card_effect_system.gd`
    - `scenes/ui/hud.gd`

    In each, update the path array to:
    ```
    "res://resources/fruit_data/tier_1_cherry.tres",
    "res://resources/fruit_data/tier_2_grape.tres",
    "res://resources/fruit_data/tier_3_strawberry.tres",
    "res://resources/fruit_data/tier_4_orange.tres",
    "res://resources/fruit_data/tier_5_apple.tres",
    "res://resources/fruit_data/tier_6_peach.tres",
    "res://resources/fruit_data/tier_7_pineapple.tres",
    "res://resources/fruit_data/tier_8_watermelon.tres",
    ```

    **Step 4: Update comments in card_effect_system.gd:**
    - Line ~57 comment: change "Pear (code tier 6)" to "Peach (code tier 6)" (the constant PINEAPPLE_TIER=6 stays -- it maps pineapple_express card to tier 6 which is now Pineapple fruit, actually more fitting!)
    - Line ~413 docstring: change "Pear is created" to "Pineapple is created" (tier 6 = Pineapple now)
    - Actually, Pineapple Express triggers when tier 6 is created. Tier 6 is now Pineapple. So the card name and fruit name NOW match! Update comments to reflect: "Pineapple Express: triggers when Pineapple (code tier 6) is created."
  </action>
  <verify>
    1. `ls resources/fruit_data/tier_1_cherry.tres resources/fruit_data/tier_7_pineapple.tres` -- renamed files exist
    2. `ls resources/fruit_data/tier_1_blueberry.tres 2>&1` -- should NOT exist
    3. `grep -r "blueberry\|tier_7_pear\|tier_3_cherry\|tier_4_strawberry\|tier_5_orange\|tier_6_apple" scripts/ scenes/ resources/fruit_data/*.tres` -- no stale references in code
    4. `grep "fruit_name" resources/fruit_data/*.tres` -- verify all 8 names match new lineup
    5. `grep "tier_1_cherry" scripts/components/merge_manager.gd` -- verify updated path
  </verify>
  <done>All 8 .tres files renamed and updated with new fruit names, colors, and sprite texture paths. All 5 GDScript path arrays updated. No stale references to old filenames or fruit names.</done>
</task>

<task type="auto">
  <name>Task 2: Remove FaceRenderer and color tinting from fruit scene</name>
  <files>
    scenes/fruit/fruit.gd
    scenes/fruit/fruit.tscn
    scenes/fruit/face_renderer.gd
  </files>
  <action>
    **Step 1: Update fruit.gd initialize() function:**
    - REMOVE the line `$Sprite2D.modulate = data.color` -- sprites now have natural colors baked in, color tinting would wash them out
    - REMOVE the line `$FaceRenderer.set_face(data.tier, data.radius)` -- faces are baked into the sprite textures
    - KEEP `$Sprite2D.texture = data.sprite` -- this now loads the kawaii PNG instead of placeholder
    - KEEP the sprite scaling logic -- the formula `data.radius / (data.sprite.get_width() / 2.0)` auto-adapts to any texture resolution. With 512x512 sprites, texture_half_width=256, so cherry (r=15) gets scale 0.059 and watermelon (r=80) gets scale 0.3125. This is correct.
    - KEEP everything else in fruit.gd untouched (collision, merging, flags)

    **Step 2: Update fruit.tscn to remove FaceRenderer node:**
    - Remove the ext_resource line: `[ext_resource type="Script" path="res://scenes/fruit/face_renderer.gd" id="4_face"]`
    - Remove the FaceRenderer node section:
      ```
      [node name="FaceRenderer" type="Node2D" parent="."]
      script = ExtResource("4_face")
      ```
    - Update `load_steps` from 5 to 4 (one fewer ext_resource)
    - Keep: RigidBody2D root, Sprite2D, CollisionShape2D, body_entered signal connection

    **Step 3: Delete face_renderer.gd and its .uid file:**
    - `git rm scenes/fruit/face_renderer.gd`
    - `git rm scenes/fruit/face_renderer.gd.uid` (if exists)

    **Step 4: Optionally remove or keep placeholder_fruit.png:**
    - Keep it for now -- no .tres file references it anymore, but it is harmless and can be cleaned up later. Do NOT delete it in this phase.

    **CRITICAL: Verify NO physics changes:**
    - CollisionShape2D is configured in fruit.gd initialize() from data.radius -- this path is UNTOUCHED
    - RigidBody2D mass is set from data.mass_override -- this path is UNTOUCHED
    - No RigidBody2D scaling occurs (Sprite2D.scale is the only scale, as it always was)
    - PhysicsMaterial ext_resource in fruit.tscn is UNTOUCHED
  </action>
  <verify>
    1. `grep "FaceRenderer\|face_renderer\|set_face" scenes/fruit/fruit.gd` -- should return nothing
    2. `grep "modulate" scenes/fruit/fruit.gd` -- should not find color tinting line
    3. `grep "FaceRenderer\|face_renderer" scenes/fruit/fruit.tscn` -- should return nothing
    4. `ls scenes/fruit/face_renderer.gd 2>&1` -- should not exist
    5. `grep "Sprite2D.texture\|CollisionShape2D\|shape.radius\|mass" scenes/fruit/fruit.gd` -- verify physics + texture assignment still present
    6. `grep "load_steps=4" scenes/fruit/fruit.tscn` -- verify updated step count
  </verify>
  <done>FaceRenderer completely removed (script deleted, node removed from .tscn, references removed from fruit.gd). Color tinting removed. Sprite texture assignment and physics initialization preserved unchanged. Fruits now display kawaii sprites with no procedural overlay.</done>
</task>

</tasks>

<verification>
- [ ] All 8 fruit tiers display unique kawaii sprites (no placeholder circles)
- [ ] Fruit names match new lineup: cherry, grape, strawberry, orange, apple, peach, pineapple, watermelon
- [ ] FaceRenderer completely removed (no face_renderer.gd, no node in .tscn, no references in fruit.gd)
- [ ] Sprite2D.modulate color tinting removed from fruit.gd
- [ ] Physics properties (radius, mass_override, is_droppable) unchanged in all .tres files
- [ ] No stale references to placeholder_fruit.png in .tres files
- [ ] No stale references to old fruit names (Blueberry, Pear) in game code
- [ ] All 5 FruitData path arrays updated correctly
- [ ] Sprite scaling auto-adapts to new 512x512 textures (formula unchanged)
</verification>

<success_criteria>
Game runs with 8 kawaii fruit sprites at correct sizes. Every tier shows its unique art with proper naming. No procedural visuals remain (no FaceRenderer, no color tint). Physics behavior identical to v1.0.
</success_criteria>

<output>
After completion, create `.planning/phases/09-fruit-sprites/09-02-SUMMARY.md`
</output>
